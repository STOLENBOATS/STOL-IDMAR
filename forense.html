<!doctype html>
<html lang="pt">
<head>
  <meta charset="utf-8">
<script>
(function(){
  if (window.__IDMAR_QSA_PATCHED_V2__) return;
  function makeSafeQSA(orig){
    return function(selector){
      try { return orig.call(this, selector); }
      catch(e){
        try{
          var sel = String(selector).replace(/\[data-x\]\("([^"]+)"\)/g, ':contains("$1")');
          var parts = sel.split(',').map(function(s){ return s.trim(); }).filter(Boolean);
          var out = [];
          for (var i=0;i<parts.length;i++){
            var part = parts[i], m = part.match(/^(.*?):contains\("([^"]+)"\)$/);
            if (m){
              var base = m[1] || '*', text = m[2].toLowerCase();
              var nodes = orig.call(this, base);
              for (var j=0;j<nodes.length;j++){
                var el = nodes[j];
                if ((el.textContent||'').toLowerCase().indexOf(text) > -1) out.push(el);
              }
            } else {
              try { var nodes2 = orig.call(this, part);
                for (var k=0;k<nodes2.length;k++) out.push(nodes2[k]); } catch(_){}
            }
          }
          out.forEach = Array.prototype.forEach; return out;
        }catch(_){ var empty=[]; empty.forEach = Array.prototype.forEach; return empty; }
      }
    };
  }
  if (!Document.prototype.__idmar_qsa_v2){
    Document.prototype.querySelectorAll = makeSafeQSA(Document.prototype.querySelectorAll);
    Document.prototype.__idmar_qsa_v2 = true;
  }
  if (!Element.prototype.__idmar_qsa_v2){
    Element.prototype.querySelectorAll = makeSafeQSA(Element.prototype.querySelectorAll);
    Element.prototype.__idmar_qsa_v2 = true;
  }
  window.__IDMAR_QSA_PATCHED_V2__ = true;
  console.info("[IDMAR shim] qSA v2: Document+Element protegidos (:contains + [data-x](..)).");
})();
</script>

  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>

  <!-- CSS base -->
  <link rel="stylesheet" href="css/styles.css">
  <link rel="stylesheet" href="css/theme-soft-light.v1.css">
  <link rel="stylesheet" href="css/nav-ribbon.v5.css"><!-- os botï¿½es novos -->

  <!-- Versï¿½o + branding -->
  <script>window.IDMAR_VERSION="Vs 1.3";</script>
  <script defer src="js/idmar-config.v4.js"></script>

  <!-- Header/i18n (core) -->
  <script defer src="js/idmar-i18n.js"></script>
  <script defer src="js/idmar-header-only.all.v4.js"></script>

  <!-- Overrides -->
  <script defer src="js/header-override.v4.js"></script>
  <script defer src="js/i18n-boot.js"></script>
  <script defer src="js/idmar-version.v4.js"></script>
  

  <!-- Bilingue PT/EN para a pï¿½gina Forense -->
  <script defer src="js/forense-bilingual.v2.js"></script>

</head>

<body>
  <!-- header ï¿½ injetado por JS -->

  <main class="container">
    <h1>Forense  ï¿½ndice</h1>

    <section class="panel">
      <h2>Carregar evidï¿½ncias</h2>
      <div class="row" style="display:flex;gap:.5rem;flex-wrap:wrap">
        <input id="evPhotos" type="file" accept="image/*" multiple />
        <select id="evContext">
          <option value="win">Contexto: WIN/HIN</option>
          <option value="motor">Contexto: Motor</option>
        </select>
        <button id="evAttach">Anexar ao histï¿½rico mais recente</button>
      </div>
      <div id="evMeta" class="meta" style="display:grid;grid-template-columns:repeat(auto-fit,minmax(240px,1fr));gap:.5rem;margin-top:.5rem"></div>
      <div id="evThumbs" class="thumbs" style="display:flex;gap:.5rem;flex-wrap:wrap"></div>
    </section>

    <section class="panel">
      <h2>Workspace</h2>
      <div class="row" style="display:flex;gap:.5rem;flex-wrap:wrap">
        <button id="lbOpen">Abrir lightbox</button>
        <label>Comparar <input id="cmpRange" type="range" min="0" max="100" value="50"/></label>
        <button id="addRect">Anotar (rect)</button>
        <button id="clearRects">Limpar anotaï¿½ï¿½es</button>
        <button id="exportPNG">Exportar PNG anotado</button>
        <button id="saveBundle">Guardar bundle (JSON)</button>
        <input id="loadBundle" type="file" accept=".json" />
      </div>
      <div class="canvas-wrap" style="position:relative;border:1px solid var(--border);border-radius:10px;overflow:hidden;background:#f1f5f9;height:540px">
        <canvas id="evCanvas" style="display:block;width:100%;height:100%"></canvas>
      </div>
      <small>Dica: a comparaï¿½ï¿½o usa a 1ï¿½ e a 2ï¿½ foto; as anotaï¿½ï¿½es servem para redacï¿½ï¿½o/realce.</small>
    </section>

    <section class="panel">
      <h2>Checklist forense</h2>
      <div class="checkboxes" style="display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:.35rem">
        <label><input type="checkbox" id="chk_rebites"> Rebites inconsistentes/aï¿½adidos</label>
        <label><input type="checkbox" id="chk_solda"> Cordï¿½es de solda anï¿½malos</label>
        <label><input type="checkbox" id="chk_placa"> Placa remarcada/substituï¿½da</label>
        <label><input type="checkbox" id="chk_tinta"> Camadas de tinta/abrasï¿½es</label>
        <label><input type="checkbox" id="chk_etq"> Etiqueta adulterada/ausente (motor)</label>
        <label><input type="checkbox" id="chk_core"> Core plug danificado/removido (motor)</label>
        <label><input type="checkbox" id="chk_boss"> Solda/corrosï¿½o anï¿½mala no boss (motor)</label>
        <label><input type="checkbox" id="chk_bloco"> Remarcaï¿½ï¿½o no bloco (motor)</label>
      </div>
      <label>Notas</label>
      <textarea id="notes" rows="4" placeholder="Observaï¿½ï¿½es tï¿½cnicas" style="width:100%;border:1px solid var(--border);border-radius:10px;padding:.5rem .6rem;background:#fff"></textarea>
    </section>
  </main>

  <footer class="footer" style="border-top:1px solid var(--border);padding:1rem;opacity:.85;background:var(--bg-elev)">IDMAR  Identificaï¿½ï¿½o Marï¿½tima</footer>

  <div class="lightbox" id="lightbox" style="position:fixed;inset:0;background:rgba(15,23,42,.85);display:none;align-items:center;justify-content:center;z-index:50">
    <img id="lbImg" alt="" style="max-width:90vw;max-height:90vh;border-radius:12px;box-shadow:0 10px 40px rgba(0,0,0,.5)"/>
  </div>

  <!-- (limpo) removido idmar-layout.r3c.js -->
  <script src="js/forense-r1.js?v=r1"></script>
<script defer src="js/forense-i18n.v2.js"></script>
</body>
</html>






