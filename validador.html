ï»¿<!doctype html>
<html lang="pt">
<head>
  <meta charset="utf-8">
  
  <script>
(function(){
  // fetch polyfill
  if (!('fetch' in window)) {
    var s=document.createElement('script');
    s.src='https://cdn.jsdelivr.net/npm/whatwg-fetch@3.6.20/dist/fetch.umd.min.js';
    document.head.appendChild(s);
  }
  // Promise polyfill
  if (!('Promise' in window)) {
    var s=document.createElement('script');
    s.src='https://cdn.jsdelivr.net/npm/promise-polyfill@8/dist/polyfill.min.js';
    document.head.appendChild(s);
  }
})();
</script>

<meta name="viewport" content="width=device-width, initial-scale=1">

<link rel="manifest" href="manifest.webmanifest">
<meta name="theme-color" content="#0b6bcb">


  
  <title>IDMAR Validador</title>
  <link rel="icon" href="img/logo-pm.png" />

  <!-- CSS base -->
  <link rel="stylesheet" href="css/styles.css">
  <link rel="stylesheet" href="css/theme-soft-light.v1.css"><!-- tema claro -->
  <link rel="stylesheet" href="css/nav-ribbon.v5.css"><!-- botï¿½es "ribbon" v5 -->
  <link rel="apple-touch-icon" href="img/logo-pm.png">


  <style>

/* Overlay de orientaï¿½ï¿½o (aparece em portrait atï¿½ ~1024px) */
#rotate-overlay{display:none;position:fixed;inset:0;background:#0008;color:#fff;z-index:9999;
  backdrop-filter: blur(2px); -webkit-backdrop-filter: blur(2px);
  align-items:center;justify-content:center;text-align:center;padding:2rem}
#rotate-overlay .box{background:#111c;padding:1rem 1.25rem;border-radius:12px;max-width:22rem}
@media (orientation:portrait) and (max-width: 1024px){
  #rotate-overlay{display:flex}
}

/* grelha responsiva (por se quiseres cair para 2?1 colunas) */
.cards{display:grid;grid-template-columns:1fr;gap:1rem}
@media(min-width: 860px){ .cards{grid-template-columns:1fr 1fr} }
@media(min-width:1100px){ .cards{grid-template-columns:1fr 1fr 1fr} }

    :root{--bg:#f8fafc;--fg:#0f172a;--bg-elev:#ffffff;--border:#e5e7eb;--link:#0b6bcb}
    html,body{height:100%}
    body{
      background:var(--bg);color:var(--fg);margin:0;display:flex;flex-direction:column;
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,'Helvetica Neue',Arial,sans-serif
    }
    main{flex:1}
    .container{max-width:1200px;margin:1.25rem auto;padding:0 1rem}
    .panel{background:var(--bg-elev);border:1px solid var(--border);border-radius:12px;padding:1rem;margin:.75rem 0}

    /* >>> trï¿½s cartï¿½es lado a lado */
    .three{display:grid;grid-template-columns:1fr;gap:1rem}
    @media(min-width:1100px){ .three{grid-template-columns:1fr 1fr 1fr} }

    label{display:block;margin:.35rem 0 .25rem}
    input[type="text"], input[type="search"], input[type="file"], select, textarea{
      width:100%;border:1px solid var(--border);background:#fff;border-radius:10px;padding:.5rem .6rem;
    }
    button{background:#0b6bcb;color:#fff;border:none;border-radius:10px;padding:.55rem .9rem;cursor:pointer}
    table{width:100%;border-collapse:collapse;margin-top:.5rem}
    th,td{border-bottom:1px solid var(--border);padding:.6rem .5rem;text-align:left}
    .small{opacity:.75;font-size:.9em}
    .badge{display:inline-block;border-radius:999px;padding:.15rem .55rem;font-weight:600}
    .good{background:#10b98120;color:#065f46}
    .bad{background:#ef444420;color:#7f1d1d}
    .footer{border-top:1px solid var(--border);padding:1rem;text-align:left;opacity:.85;background:var(--bg-elev)}

    /* utilidades */
    .mt-2{margin-top:.5rem}
    .muted{opacity:.75}
    #engine-sn-window .chip{
      display:inline-block;border:1px solid var(--border);border-radius:999px;
      padding:.15rem .5rem;margin:.15rem .25rem 0 0
    }
    #engine-sn-result ul{margin:.25rem 0 0 .9rem}
  </style>

  <!-- Gate de sessï¿½o simples -->
  <script>
    (function(){
      try{
        var ok = sessionStorage.getItem('IDMAR_SESSION')==='ok' || sessionStorage.getItem('NAV_SESSION')==='ok';
        if(!ok) location.replace('login.html');
      }catch(e){}
    })();
  </script>

  <!-- Versï¿½o + branding -->
  <script>window.IDMAR_VERSION="Vs 1.3";</script>
  <script defer src="js/idmar-config.v4.js"></script>

  <!-- Core: i18n + header -->
  <script defer src="js/idmar-i18n.js"></script>
  <script defer src="js/idmar-header-only.all.v4.js"></script>

  <!-- Overrides (aplicam labels, ribbons e rodapï¿½) -->
  <script defer src="js/header-override.v4.js"></script>
  <script defer src="js/i18n-boot.js"></script>
  <script defer src="js/idmar-version.v4.js"></script>
</head>

<body>
  <div id="rotate-overlay" aria-live="polite">
  <div class="box">
    <h3 style="margin:0 0 .5rem">Melhor em modo horizontal / Best viewed in landscape</h3>
    <p style="margin:0">
      Rode o dispositivo para <strong>landscape</strong> para ver os trï¿½s cartï¿½es lado a lado.<br>
      Please rotate your device to <strong>landscape</strong> to view the three cards side by side.
    </p>
  </div>
</div>

  <!-- header ï¿½ injetado por JS -->

  <main class="container">
    <h1>Validador</h1>

    <section class="three">
      <!-- WIN -->
      <div class="panel" id="card-win">
        <h2>Validador WIN</h2>
        <form id="formWin">
          <label for="win">WIN / HIN</label>
          <input id="win" type="text" placeholder="Ex.: PT-ABC12345D404"/>
          <div style="margin:.5rem 0">
            <button id="btnWin" type="submit">Validar WIN</button>
          </div>

          <div style="margin-top:.5rem">
            <label for="winPhoto">Foto opcional / Optional photo</label>
            <input id="winPhoto" type="file" accept="image/*"/>
          </div>

          <div id="winOut" style="margin-top:.75rem"></div>

          <table>
            <thead>
              <tr><th>Campo / Field</th><th>Valor / Value</th><th>Interpretaï¿½ï¿½o / Meaning</th></tr>
            </thead>
            <tbody id="interpWinBody"></tbody>
          </table>
        </form>
      </div>

      <!-- MOTOR (como estï¿½) -->
      <div class="panel" id="card-motor">
        <h2>Validador Motor</h2>
        <form id="formMotor">
          <label for="brand">Marca</label>
          <!-- marca -->
          <select id="brand" data-engine-field="brand">
            <option>Yamaha</option><option>Honda</option><option>Suzuki</option><option>Tohatsu</option>
            <option>Mercury</option><option>MerCruiser</option><option>Volvo Penta</option>
            <option>Yanmar</option><option>Evinrude/Johnson</option>
          </select>

          <!-- aqui o JS pode injetar campos dinï¿½micos (shaft / par de letras / sï¿½rie, etc.) -->
          <div id="brandDynamic"></div>

          <div style="margin-top:.5rem;display:grid;grid-template-columns:repeat(auto-fit,minmax(160px,1fr));gap:.5rem">
            <div>
              <label>Modelo (pesquisa)</label>
              <input id="srch_model" type="text" placeholder="Ex.: BF40A ou DF140A"
                     data-engine-field="model_code"/>
            </div>
            <div>
              <label>Potï¿½ncia (hp)</label>
              <input id="srch_power" type="text" placeholder="Ex.: 150"
                     data-engine-field="power"/>
            </div>
            <div>
              <label>Cilindrada (cc)</label>
              <input id="srch_disp" type="text" placeholder="Ex.: 2670"
                     data-engine-field="displacement"/>
            </div>
            <div>
              <label>Ano</label>
              <input id="srch_year" type="text" placeholder="Ex.: 2017"
                     data-engine-field="year"/>
            </div>
            <div>
              <label>Origem</label>
              <input id="srch_origin" type="text" placeholder="Ex.: Japï¿½o"
                     data-engine-field="origin"/>
            </div>
          </div>

          <div style="margin:.5rem 0">
            <button id="btnMotor" type="submit">Validar Motor</button>
          </div>

          <div style="margin-top:.5rem">
            <label for="motorPhoto">Foto opcional / Optional photo</label>
            <input id="motorPhoto" type="file" accept="image/*"/>
          </div>

          <div id="motorOut" style="margin-top:.75rem"></div>
        </form>
      </div>

      <!-- Nï¿½ de motor ï¿½ interligado ao cartï¿½o do Motor -->
      <div class="panel" id="card-serial">
        <h2>Nï¿½ do motor / Engine serial</h2>

        <!-- Entrada ï¿½nica (auto-parse) -->
        <input id="engine-sn-raw" type="text"
               placeholder="Ex.: BF40A-BAAL-1234567, BAAL-1234567, 1B123456"
               autocomplete="off" />

        <!-- Honda: exterior/interior (dois nï¿½meros) -->
        <div class="sn-kind" style="margin-top:.5rem">
          <label><input type="radio" name="engine-sn-kind" value="auto" checked> Auto</label>
          <label><input type="radio" name="engine-sn-kind" value="exterior"> Exterior</label>
          <label><input type="radio" name="engine-sn-kind" value="interior"> Interior</label>
        </div>

        <!-- Janela(s) de intervalo calculadas a partir do cartï¿½o do Motor -->
        <div id="engine-sn-window" class="mt-2"></div>

        <!-- Resultado/Notas -->
        <small id="engine-sn-hints" class="muted"></small>
        <div id="engine-sn-result" class="mt-2"></div>
      </div>
    </section>
  </main>

  <footer class="footer" id="fallback-footer">IDMAR ï¿½ Identificaï¿½ï¿½o Marï¿½tima</footer>

  <!-- Removido idmar-layout.r3b.js para nï¿½o duplicar header -->
  <script src="js/validador-win.r3b.js?v=r3b"></script>
  <script src="js/validador-motor.r3d.js?v=r3d"></script>
  <script defer src="js/validator-enhancements.v4.js"></script>

  <!-- CONFIGURADOR (schema v2) -->
  <script type="module"
    src="js/engine_picker.v2.4.js"
    data-catalog="data/engines_catalog.v2.json"></script>

  <!-- Validador de combinaï¿½ï¿½es (usa o mesmo catï¿½logo v2) -->
  <script defer src="js/engine_validation.v1.js"></script>

  <!-- Admin rï¿½pido embutido (motores + WIN) ï¿½ se Nï¿½O quiseres este bloco na pï¿½gina, deixa comentado -->
  <!-- <script defer src="js/engine_admin_embed.v1.js"></script> -->

  <!-- Botï¿½o "Admin" no ribbon -->
  <script>window.IDMAR_ADMIN_URL = 'admin-engines.html';</script>
  <script defer src="js/ribbon-admin.v1.js"></script>

  <!-- AUTOCOMPLETE ANTIGO (schema v1) -->
  <script type="module"
    src="js/engine_autocomplete_addon.v1.js"
    data-catalog="data/engines_catalog.v1.json"></script>

  <!-- i18n/ribbon/forense patches existentes -->
  <script defer src="js/patch-forense-i18n-ribbon.r1.js?v=r1"></script>

  <!-- SN: parser + ranges + painel (interligado ao Motor) -->
  <script defer src="js/validators/engine-sn.v1.js?v=r7"></script>
  
  <script defer src="js/engine-serial-range-check.v1.js?v=r8"></script>
  <script defer src="js/engine-sn-panel.v2.js?v=r2"></script>

  <!-- NOVO: overlay de i18n para a página do Validador -->
<script defer src="js/validador-i18n.v1.js?v=r1"></script>
<script defer src="js/utf8-sweep.v1.js?v=r2"></script>

  <script>
(function(){
  // Tentar bloquear para landscape (nota: iOS Safari ignora; Android Chrome honra em apps instaladas)
  async function tryLockLandscape(){
    try {
      if (screen.orientation && screen.orientation.lock) {
        await screen.orientation.lock('landscape');
      }
    } catch(e){ /* alguns browsers nï¿½o permitem ï¿½ tudo bem */ }
  }
  // Sï¿½ tentamos apï¿½s um gesto do utilizador (maior compatibilidade)
  document.addEventListener('click', tryLockLandscape, { once:true });

  // Ajuste de viewport em iOS para zoom correto (opcional, seguro)
  function tweakIOSViewport(){
    var meta = document.querySelector('meta[name=viewport]');
    if (!meta) return;
    var isiOS = /iphone|ipad|ipod/i.test(navigator.userAgent);
    if (isiOS) meta.setAttribute('content','width=device-width, initial-scale=1, viewport-fit=cover');
  }
  tweakIOSViewport();
})();
</script>

  
<script>
if ('serviceWorker' in navigator) {
  window.addEventListener('load', function(){
    navigator.serviceWorker.register('/STOL-IDMAR/sw.js').catch(console.error);
  });
}
</script>
</body>
</html>





